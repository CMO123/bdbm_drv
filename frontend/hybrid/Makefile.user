# Makefile for a RISA Device Driver
#

CC = gcc
FTL := ../../ftl
COMMON := ../../include
USER := ../user

CFLAGS := -Wall -g -D_LARGEFILE64_SOURCE -D_GNU_SOURCE 
LIBS += -lm -lpthread -lrt

INCLUDES = -I$(PWD)/../../include \
		   -I$(PWD)/../../include/utils \
		   -I$(PWD)/$(FTL) \
		   -I$(PWD)/$(USER) \
		   -I$(PWD)/../../devices/cpp 	# temp

CFLAGS += -D HASH_BLOOM=20 \
		  -D CONFIG_ENABLE_MSG \
		  -D CONFIG_ENABLE_DEBUG \
		  -D USER_MODE \
		  -D USE_PMU \
		  -D USE_BLOCKIO_STUB \

DMLIB := ../../devices/libramdrive/libramdrive.a
#DMLIB := dm_proxy.c

SRCS := \
	main.c \
	host_blockio_stub.c \
	$(USER)/uparams.c \
	$(USER)/host_user.c \
	$(FTL)/pmu.c \
	$(FTL)/hlm_nobuf.c \
	$(FTL)/hlm_buf.c \
	$(FTL)/hlm_dftl.c \
	$(FTL)/hlm_rsd.c \
	$(FTL)/llm_noq.c \
	$(FTL)/llm_mq.c \
	$(FTL)/algo/abm.c \
	$(FTL)/algo/no_ftl.c \
	$(FTL)/algo/block_ftl.c \
	$(FTL)/algo/page_ftl.c \
	$(FTL)/algo/dftl_map.c \
	$(FTL)/algo/dftl.c \
	$(FTL)/queue/queue.c \
	$(FTL)/queue/prior_queue.c \
	$(FTL)/queue/rd_prior_queue.c \
	$(COMMON)/utils/utime.c \
	$(COMMON)/utils/ufile.c \
	$(COMMON)/utils/uthread.c \
	$(COMMON)/utils/upage.c \
	$(COMMON)/3rd/uilog.c \
	$(DMLIB) \


libftl: $(SRCS) $(DMLIB)
	$(CC) $(INCLUDES) $(CFLAGS) -o $@ $(SRCS) $(LIBS) 

clean:
	@$(RM) *.o core *~ libftl 
	@cd ../user; rm -rf *.o
	@cd ../../ftl; rm -rf *.o .*.cmd; rm -rf */*.o */.*.cmd;
	@cd ../../include; rm -rf *.o .*.cmd; rm -rf */*.o */.*.cmd;
	@cd ../../include/utils; rm -rf *.o .*.cmd; rm -rf */*.o */.*.cmd;

